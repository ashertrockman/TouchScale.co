<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TouchScale : Weigh things on your iPhone!</title>    
    <style>
        * {
            font-family: 'San Francisco Text', sans-serif;   
            -webkit-user-select: none;
	}
        body, html {
            margin: 0;
            padding: 0;
        }
        #container {
            width: 100%;
	    max-width: 415px;
            height: 100%;
            margin: 0 auto;
            position: relative;
            border-top: 20px solid #76D0F3;
            box-sizing: border-box;
	    max-height: 800px; 
       }
        #footer {
            width: 100%;
            height: 130px;
            background: #76D0F3;
            position: absolute;
            bottom: 0px;
        }
        #controls {
            width: 100%;
            height: 50px;
            position: absolute;
	    background: #66C0D3;
            bottom: 0px;
        }
        #weight {
            width: 100%;
            height: 75px;
            text-align: center;
            font-size: 52px;
            color: white;
            line-height: 75px;
            top: 0px;
            position: absolute;
        }
        #tare {
            background: #6EDB4E;
	    color: white;
            text-align: center;
            width: 50%;
            font-size: 24px;
            line-height: 50px;
            height: 50px;
            left: 0px;
        }
        select {
            width: 40%;
            position: absolute;
            right: 20px;
            height: 25px;
            -webkit-appearance: none;
            bottom: 5px;
            display: block;
	    padding-right: 15px;
            background: url(https://cdn4.iconfinder.com/data/icons/flat-color-icons/504/expand-16.png) no-repeat 95% #fff;
            border: none;
            outline: none;
            border-radius: 5px;
	    font-weight: bold;
	    font-size: 14px;
	    padding: 0px 5px;
        }
        #label {
            position: absolute;
            left: 50%;
            font-size: 12px;
            width: 50%;
            top: 0px;
            text-align: center;
            top: 4px;
            color: white;
        }
	a, a:hover, a:active, a:visited {
		color: white;
	}
        #logo {
            height: 30px;
            width: 150px;
            text-align: center;
            line-height: 30px;
            border-bottom-left-radius: 5px;
            border-bottom-right-radius: 5px;
            position: absolute;
            top: -10px;
            left: 0px;
            right: 0px;
            margin: auto;
            color: white;
            background: #76D0F3;
        }
        #circle {
            width: 350px;
            bottom: 145px;
            position: absolute;
            top: 45px;
            left: 0px;
            right: 0px;
            margin: auto;
            border: 4px dashed #ddd;
        }
	#circle2 {
		position: absolute;
		border-radius: 50%;
		background: #F8E14B;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		margin: auto;
		width: 0px;
		height: 0px;
	}
        #message {
            height: 100px;
            width: 320px;
            text-align: center;
            position: absolute;
            top: 0px; left: 0px;
            bottom: 0px; right: 0px;
            margin: auto;
            font-size: 12px;
	    color: #777;
        }
    </style>
</head>
<body>

    <div id="container">
 
	<div style="position: absolute; z-index: 100; top: -18px; left: 2px; font-size: 12px; height: 15px; width: 150px;">
		<a href="http://ashertrockman.github.io/ios/2015/10/24/3d-touch-scale.html">How does this work?</a>
	</div>


       <div id="logo">touch<b>scale</b></div>
        <div id="circle">
            <div id="message">
                Place something capacitive, like an apple.<br>
                <b>Don't place anything that can scratch your screen.</b>
                <br>
                If you have changed your 3D Touch sensitivity, set it below.
           </div>
	    <div id="circle2"></div> 
        </div>
        <div id="footer">
            <div id="weight">
                0.00g
            </div>
            <div id="controls">                     <div id="tare">
                    Tare
                </div>
                <select id="sense">
			<option value="0">Light</option>
			<option value="1" selected>Medium</option>
			<option value="2">Firm</option>
		</select>
                <div id="label">
                     3D Touch Sensitivity
                </div>
            </div>
        </div>
    </div>
    <script>
	var tare = document.getElementById('tare')
	var currentTouchF;

	function transformTare() {
		if(typeof currentTouchF == 'undefined')
			return

		tare.style.webkitTransform = 'rotateX(' + currentTouchF.force * 60 + 'deg)'
	}

	setInterval(transformTare, 10);

	function tareTouchStart(e) {
		e.preventDefault();
		currentTouchF = e.touches[0];
		tareForce = e.touches[0].force
	}

	tare.addEventListener('touchstart', tareTouchStart, false)

	var weight = document.getElementById('weight');
	var forceConversions = [0.020833333, 0.0166666, 0.0138888883369941];
	var fcIndex = 1;
	var tare = document.getElementById('tare');
	var circle2 = document.getElementById('circle2');
	var maxForce = 6.666666667;
	var tareForce = 0;
	var currentTouch;
	var updater = 0;


	document.getElementById('sense').onchange = function(e) {
		fcIndex = this.selectedIndex;
	}

	function onForceStart(event) {
		currentTouch = event.touches[0]
	}

	function onForceMove(event) {
		event.preventDefault();
		currentTouch = event.touches[0]
	}	

	function onForceEnded(event) {
		event.preventDefault();
		currentTouch = undefined;
	}

	function updateForce() {

		var force = 0;

		if(typeof currentTouch == 'undefined')
			force = 0
		else
			force = currentTouch.force


		circle2.style.height = ((force) * 345) + 'px';
		circle2.style.width = ((force) * 345) + 'px';
		document.getElementById('container').style.webkitTransform = 'rotateX(' + force * -20 + 'deg) scale(' + (1 - (force * 0.06))  + ')';
		var px = force * 5 + 'px';

		if(force > 0)
			document.body.style.boxShadow = '0px 0px ' + ' 15px ' + px + ' rgba(0, 0, 0, 0.333) inset';
		weight.innerHTML  = (((force - tareForce) * maxForce) / forceConversions[fcIndex]).toFixed(2) + 'g';
	}

	setInterval(updateForce, 1)

	var circle = document.getElementById('circle')

	circle.addEventListener('touchmove', onForceMove, false)	
	circle.addEventListener('touchstart', onForceStart, false)	
	circle.addEventListener('touchend', onForceEnded, false)

	    </script>
</body>
</html>
