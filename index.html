<html lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>TouchScale : Weigh things on your iPhone!</title>
	<style>
		#container {
			width: 400px;
			margin: 0px auto;
			position: relative;
		}
		#circle {
			width: 400px;
			height: 400px;
			border-radius: 50%;
			border: 3px dashed #ccc;
			margin: 0px auto;
			color: #111;
			font-family: 'Helvetica Neue', sans-serif;
			text-align: center;
			-webkit-user-select: none;
			position: relative;
		}
		#circle2 {
			width: 0px;
			height: 0px;
			position: absolute;
			background: rgb(100, 230, 100);
			top: 0; left: 0; right: 0; bottom: 0;
			margin: auto;
			border-radius: 50%;
		}
		#weight {
			width: 400px;
			height: 100px;
			margin: 0px auto;
			margin-top: 30px;
			color: #111;
			font-family: 'Helvetica Neue', sans-serif;
			text-align: center;
			line-height: 100px;
			font-size: 32px;
		}
		#tare {
			width: 400px;
			height: 40px;
			background: lightblue;
			margin: 0px auto;
			line-height: 40px;
			text-align: center;
			color: white;
			font-family: 'Helvetica Neue', sans-serif;
			font-size: 18px;
			font-weight: bold;
		}
		#info {
			width: 400px;
			height: 20px;
			font-size: 10px;
			margin-top: 10px;	
			font-family: 'Helvetica Neue', sans-serif;
			text-align: center;
		}
		span {
			color: #777;
		}
		form {
			position: absolute;
			left: 5px;
			bottom: 60px;
			font-size: 18px;
		}
		form > label {
			font-size: 12px;
		}
	</style>
</head>

<body>
	<div id="container">
		<div id="circle">Place something capacitive, like an apple. <br><b>Don't use anything that can scratch your iPhone.</b><br><span>If changed, choose 3D Touch sensitivity.</span><div id="circle2"></div></div>
		<div id="weight">0.00g</div>
		<form>
		<label for="senes">Sensitivity</label>
		<select id="sense">
			<option value="0">Light</option>
			<option value="1" selected>Medium</option>
			<option value="2">Firm</option>
		</select>
		</form>
		<div id="tare">TARE</div>

		<div id="info"><a href="http://ashertrockman.github.io/ios/2015/10/24/3d-touch-scale.html">How does this work?</a></div>
	</div>
</body>

<script>

	var weight = document.getElementById('weight');
	var forceConversions = [0.020833333, 0.0166666, 0.0138888883369941];
	var fcIndex = 1;
	var tare = document.getElementById('tare');
	var circle2 = document.getElementById('circle2');
	var maxForce = 6.666666667;
	var tareForce = 0;
	var currentTouch;
	var updater = 0;


	document.getElementById('sense').onchange = function(e) {
		fcIndex = this.selectedIndex;
	}

	function onForceStart(event) {
		currentTouch = event.touches[0]
	}

	function onForceMove(event) {
		event.preventDefault();
		currentTouch = event.touches[0]
	}	

	function onForceEnded(event) {
		event.preventDefault();
		currentTouch = undefined;
	}

	function updateForce() {

		var force = 0;

		if(typeof currentTouch == 'undefined')
			force = 0
		else
			force = currentTouch.force


		circle2.style.height = ((force) * 390) + 'px';
		circle2.style.width = ((force) * 390) + 'px';
		weight.innerHTML  = (((force - tareForce) * maxForce) / forceConversions[fcIndex]).toFixed(2) + 'g';
	}

	setInterval(updateForce, 1)

	var circle = document.getElementById('circle')

	circle.addEventListener('touchmove', onForceMove, false)	
	circle.addEventListener('touchstart', onForceStart, false)	
	circle.addEventListener('touchend', onForceEnded, false)

	tare.addEventListener('touchstart', function(e) {
		e.preventDefault();
		tareForce = currentTouch.force;
	}, false);
	
</script>
</html>
